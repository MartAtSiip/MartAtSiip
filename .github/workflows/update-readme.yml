name: Update README with Work Duration and Age

on:
  schedule:
    - cron: "0 0 * * *" # Runs every day at midnight
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Calculate and update work duration and age
        run: |
          # Set your start work date and birth date
          START_WORK_DATE="2023-07-23"
          BIRTH_DATE="2005-06-06"

          # Calculate the current date
          TODAY=$(date +%Y-%m-%d)

          # Calculate the difference in years for work duration and age
          WORK_YEARS=$(($(date -d "$TODAY" +%Y) - $(date -d "$START_WORK_DATE" +%Y)))
          WORK_MONTHS=$(($(date -d "$TODAY" +%-m) - $(date -d "$START_WORK_DATE" +%-m)))
          WORK_DAYS=$(($(date -d "$TODAY" +%-d) - $(date -d "$START_WORK_DATE" +%-d)))

          # Adjust if necessary
          if [ $WORK_DAYS -lt 0 ]; then
            WORK_MONTHS=$((WORK_MONTHS - 1))
            WORK_DAYS=$((WORK_DAYS + 30))
          fi
          if [ $WORK_MONTHS -lt 0 ]; then
            WORK_YEARS=$((WORK_YEARS - 1))
            WORK_MONTHS=$((WORK_MONTHS + 12))
          fi

          # Calculate age
          AGE=$(($(date -d "$TODAY" +%Y) - $(date -d "$BIRTH_DATE" +%Y)))
          if [ $(date -d "$TODAY" +%-m) -lt $(date -d "$BIRTH_DATE" +%-m) ] || 
             { [ $(date -d "$TODAY" +%-m) -eq $(date -d "$BIRTH_DATE" +%-m) ] && [ $(date -d "$TODAY" +%-d) -lt $(date -d "$BIRTH_DATE" +%-d) ]; }; then
            AGE=$((AGE - 1))
          fi

          # Prepare README content with correct YAML syntax
          README_CONTENT=$(cat <<EOF
# ðŸ‘‹ Hello! I'm Mart
I'm a **Medior Developer** at **Siip Group**, currently **$AGE years old**, passionate about software development and backend systems. I have experience working with various technologies and Iâ€™m always eager to learn more.

## ðŸ› ï¸ Tech

### Languages & Frameworks

![Java](https://img.shields.io/badge/Java-ED8B00?style=for-the-badge&logo=java&logoColor=white)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-6DB33F?style=for-the-badge&logo=spring-boot&logoColor=white)
![Laravel](https://img.shields.io/badge/Laravel-FF2D20?style=for-the-badge&logo=laravel&logoColor=white)
![PHP](https://img.shields.io/badge/PHP-777BB4?style=for-the-badge&logo=php&logoColor=white)
![SQL](https://img.shields.io/badge/SQL-00758F?style=for-the-badge&logo=postgresql&logoColor=white)
![Python](https://img.shields.io/badge/Python-FFD43B?style=for-the-badge&logo=python&logoColor=blue)

### Hardware

![XPS 13 Plus (2023)](https://img.shields.io/badge/dell-XPS%2013%20Plus%20-007DB8?style=for-the-badge&logo=dell&logoColor=white)
![Ubuntu](https://img.shields.io/badge/Ubuntu-E95420?style=for-the-badge&logo=ubuntu&logoColor=white)

## ðŸ’¼ Work Experience

I've been working at Siip Group since **July 23, 2023**, which is **$WORK_YEARS years, $WORK_MONTHS months, and $WORK_DAYS days** now!

## ðŸ“Š GitHub Stats
![Mart's GitHub stats](https://github-readme-stats.vercel.app/api?username=MartAtSiip&show_icons=true&theme=transparent)

## ðŸ”— Connect with me
- [GitHub](https://github.com/MartAtSiip)
- [LinkedIn](https://www.linkedin.com/in/martvandermolen)
EOF
)

          # Update the README.md file
          echo "$README_CONTENT" > README.md

      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Updated work duration and age"
          git push
